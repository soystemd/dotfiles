#!/bin/sh
# run aard2 dictionary's local java webserver.

pkgdir="$XDG_DATA_HOME/aard2"
pkgname='aard2-web-0.7-java6.jar'
pkgurl='https://github.com/itkach/aard2-web/releases/download/0.7/aard2-web-0.7-java6.jar'

slobdir="$pkgdir/slob"
slobname='enwiktionary-20201207.slob'
sloburl='https://ftp.halifax.rwth-aachen.de/aarddict/enwiki/enwiktionary20201207-slob/enwiktionary-20201207.slob'

[ ! -f /usr/bin/aria2c ] && echo error: aria2c is not installed for downloading files && exit

if [ ! -r "${pkgdir}/${pkgname}" ]; then
    mkdir -p "$pkgdir"
    $TERMINAL -e sh -c "
        echo -e '\nDownloading aard2\n'
        aria2c --no-conf --dir=$pkgdir --out=$pkgname $pkgurl
    "
fi

if [ ! -r "${slobdir}/${slobname}" ]; then
    mkdir -p "$slobdir"
    $TERMINAL -e sh -c "
        echo -e '\nDownloading aard2 slob dictionary file\n'
        aria2c --no-conf --dir=$slobdir --out=$slobname $sloburl
    "
fi

pgrep --full 'java -XX:' ||
    eval setsid -f java -XX:+SuppressFatalErrorMessage -Dslobber.browse=true \
    jar "${pkgdir}/${pkgname}" "${slobdir}/${slobname}" >/dev/null 2>&1
